version: '3.8'
services:
  keycloak:
    image: quay.io/keycloak/keycloak:21.1.1
    command: start-dev
    environment:
      KEYCLOAK_ADMIN: admin
      KEYCLOAK_ADMIN_PASSWORD: admin
    ports:
      - "8080:8080"
  activemq:
    image: apache/activemq-classic:5.18.3
    ports:
      - "61616:61616"
      - "8161:8161"
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: meditrackdb
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    ports:
      - "5432:5432"

user-service:
  build: ./user-service
  ports:
    - "8092:8092"
  environment:
    SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/meditrackdb
    SPRING_DATASOURCE_USERNAME: postgres
    SPRING_DATASOURCE_PASSWORD: password
    ACTIVEMQ_URL: tcp://activemq:61616
    ACTIVEMQ_USER: admin
    ACTIVEMQ_PASSWORD: admin
    KEYCLOAK_ISSUER_URI: http://keycloak/realms/meditrack
  depends_on:
    - activemq
    - postgres
    - keycloak

appointment-service:
  build: ./appointment-service
  ports:
    - "8093:8093"
  environment:
    SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/meditrackdb
    SPRING_DATASOURCE_USERNAME: postgres
    SPRING_DATASOURCE_PASSWORD: password
    ACTIVEMQ_URL: tcp://activemq:61616
    ACTIVEMQ_USER: admin
    ACTIVEMQ_PASSWORD: admin
    KEYCLOAK_ISSUER_URI: http://keycloak/realms/meditrack
  depends_on:
    - activemq
    - postgres
    - keycloak

inventory-service:
  build: ./inventory-service
  ports:
    - "8094:8094"
  environment:
    SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/meditrackdb
    SPRING_DATASOURCE_USERNAME: postgres
    SPRING_DATASOURCE_PASSWORD: password
    ACTIVEMQ_URL: tcp://activemq:61616
    ACTIVEMQ_USER: admin
    ACTIVEMQ_PASSWORD: admin
    KEYCLOAK_ISSUER_URI: http://keycloak/realms/meditrack
  depends_on:
    - activemq
    - postgres
    - keycloak

billing-service:
  build: ./billing-service
  ports:
    - "8095:8095"
  environment:
    SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/meditrackdb
    SPRING_DATASOURCE_USERNAME: postgres
    SPRING_DATASOURCE_PASSWORD: password
    ACTIVEMQ_URL: tcp://activemq:61616
    ACTIVEMQ_USER: admin
    ACTIVEMQ_PASSWORD: admin
    KEYCLOAK_ISSUER_URI: http://keycloak/realms/meditrack
  depends_on:
    - activemq
    - postgres
    - keycloak

notification-service:
  build: ./notification-service
  ports:
    - "8097:8097"
  environment:
    SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/meditrackdb
    SPRING_DATASOURCE_USERNAME: postgres
    SPRING_DATASOURCE_PASSWORD: password
    ACTIVEMQ_URL: tcp://activemq:61616
    ACTIVEMQ_USER: admin
    ACTIVEMQ_PASSWORD: admin
    KEYCLOAK_ISSUER_URI: http://keycloak/realms/meditrack
  depends_on:
    - activemq
    - postgres
    - keycloak

  dashboard:
    build: ./dashboard
    ports:
      - "3000:80"
    depends_on:
      - keycloak
